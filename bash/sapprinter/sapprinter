#!/bin/bash
LOGGING="yes"
LOGFILE="/var/tmp/sapprinter.log"

log() {
	if [ ${LOGGING} = "yes" ];then
		echo "$@" >> ${LOGFILE}
	fi
}

logexec() {
	$@
	finish=$?
	log ">>$@"
	[ $finish -ne 0 ] && log "logexec: $@:return status ${finish}"
}


log "======================================"
log "sappriter was called at $(date -R)\n"
log "$0 ${@}"

former=$1
log "former=${former}"
shift
printer=$1
log "printer=${printer}"
shift
log "prameters for ${printer}:$@"

if [ ${former} = "pdftk" ];then
	log "pdftk is a former"
	in_file=/var/tmp/infile.pdf
	log "in_file=${in_file}"
	out_file=/var/tmp/outfile.pdf
	log "out_file=${out_file}"
	logexec cp /proc/self/fd/0 ${in_file}
	logexec pdftk ${in_file} cat 1-endN output ${out_file}
	logexec ${printer} $@ ${out_file}
	logexec rm ${in_file}
	logexec rm ${out_file}
fi


log "End."
log "======================================"
log ""
